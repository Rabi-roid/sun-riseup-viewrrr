
# 2025-07-03 アーキテクチャ改善タスク

## Phase 1: 簡単なリファクタリング

- [ ] **データ取得ロジックのカスタムフック化:**
  - `ImageViewer.tsx` 内の `useSWR` ロジックを `useImages(folderPath)` のようなカスタムフックに切り出す。
  - **理由:** 関心の分離。コンポーネントは表示に集中させ、データ取得ロジックを再利用可能にする。影響範囲が限定的で最も簡単。

- [ ] **ローディング/エラー表示の共通化準備:**
  - 汎用的な `Spinner` コンポーネントと `ErrorBoundary` コンポーネントを作成する。
  - **理由:** `Suspense` 導入の準備。UIパーツを先に作っておくことで、次のステップがスムーズになる。

## Phase 2: 状態管理の導入

- [ ] **Zustandの導入とストア作成:**
  - `zustand` をインストールする。
  - `currentFolderPath` を管理する `viewStore` を作成する。
  - **理由:** グローバルな状態管理を一元化する第一歩。まずは最も重要な状態から移行する。

- [ ] **`App.tsx` と `Sidebar` のリファクタリング:**
  - `App.tsx` から `currentFolderPath` の `useState` を削除し、`viewStore` から取得するように変更する。
  - `Sidebar` の `onFolderSelect` は、ストアのアクションを直接呼ぶように変更する。
  - **理由:** propsのバケツリレーをなくし、コンポーネントを疎結合にする。

## Phase 3: APIの型安全性強化

- [ ] **`tauri-specta` の導入:**
  - Rust側に `specta` と `tauri-specta` を導入し、型生成の設定を行う。
  - フロントエンドで型が自動生成されるようにビルドスクリプトを修正する。
  - **理由:** プロジェクトで最も重要な「実行時エラーの防止」。フロントとバックの連携を盤石にする。設定がやや複雑なため、他のリファクタリングが完了してから着手するのが望ましい。

- [ ] **型安全なAPIクライアントへの移行:**
  - 生成された型定義とクライアントを使い、既存の `invoke` 呼び出しを全て置き換える。
  - **理由:** 型安全性の恩恵をプロジェクト全体で受けるための最終ステップ。
